from .. import Network, Bus, Line, Generator, Load, WindGenerator, ThermalGenerator
class IEEE119(Network):
    """
    Classe para representar o sistema de teste de 119 barras fornecido.
    A modelagem é completa, sem omissão de dados.
    """
    def __init__(self):
        super().__init__(name="Sistema de 119 Barras")
        self._create_buses()
        self._create_lines()
        self._create_generators()
        self._create_loads()

    def _create_buses(self):
        """
        Cria as 119 barras do sistema a partir da matriz DBAR.
        - Barra 69 é a referência (Slack).
        - Ângulos são convertidos de graus para radianos.
        """
        bus_type_map = {0: 'PQ', 1: 'PV', 2: 'Slack'}
        
        # Dados da matriz DBAR: [NB, T, G, VT, Angle, PG, QG, QMIN, QMAX, PLOAD, QLOAD, QBAR]
        bus_data = [
            [1, 1, 0, 0.955, 10.67, 0.0, 0.0, -5.0, 15.0, 51.0, 27.0, 0.0],
            [2, 0, 0, 0.971, 11.22, 0.0, 0.0, 0.0, 0.0, 20.0, 9.0, 0.0],
            [3, 0, 0, 0.968, 11.56, 0.0, 0.0, 0.0, 0.0, 39.0, 10.0, 0.0],
            [4, 1, 1, 0.998, 15.28, -9.0, 0.0, -300.0, 300.0, 30.0, 12.0, 0.0],
            [5, 0, 0, 1.002, 15.73, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -40.0],
            [6, 1, 0, 0.99, 13.0, 0.0, 0.0, -13.0, 50.0, 52.0, 22.0, 0.0],
            [7, 0, 0, 0.989, 12.56, 0.0, 0.0, 0.0, 0.0, 19.0, 2.0, 0.0],
            [8, 1, 1, 1.015, 20.77, -28.0, 0.0, -300.0, 300.0, 0.0, 0.0, 0.0],
            [9, 0, 0, 1.043, 28.02, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [10, 1, 1, 1.05, 35.61, 450.0, 0.0, -147.0, 200.0, 0.0, 0.0, 0.0],
            [11, 0, 0, 0.985, 12.72, 0.0, 0.0, 0.0, 0.0, 70.0, 23.0, 0.0],
            [12, 1, 0, 0.99, 12.2, 85.0, 0.0, -35.0, 120.0, 47.0, 10.0, 0.0],
            [13, 0, 0, 0.968, 11.35, 0.0, 0.0, 0.0, 0.0, 34.0, 16.0, 0.0],
            [14, 0, 0, 0.984, 11.5, 0.0, 0.0, 0.0, 0.0, 14.0, 1.0, 0.0],
            [15, 1, 0, 0.97, 11.23, 0.0, 0.0, -10.0, 30.0, 90.0, 30.0, 0.0],
            [16, 0, 0, 0.984, 11.91, 0.0, 0.0, 0.0, 0.0, 25.0, 10.0, 0.0],
            [17, 0, 0, 0.995, 13.74, 0.0, 0.0, 0.0, 0.0, 11.0, 3.0, 0.0],
            [18, 1, 0, 0.973, 11.53, 0.0, 0.0, -16.0, 50.0, 60.0, 34.0, 0.0],
            [19, 1, 0, 0.963, 11.05, 0.0, 0.0, -8.0, 24.0, 45.0, 25.0, 0.0],
            [20, 0, 0, 0.958, 11.93, 0.0, 0.0, 0.0, 0.0, 18.0, 3.0, 0.0],
            [21, 0, 0, 0.959, 13.52, 0.0, 0.0, 0.0, 0.0, 14.0, 8.0, 0.0],
            [22, 0, 0, 0.97, 16.08, 0.0, 0.0, 0.0, 0.0, 10.0, 5.0, 0.0],
            [23, 0, 0, 1.0, 21.0, 0.0, 0.0, 0.0, 0.0, 7.0, 3.0, 0.0],
            [24, 1, 1, 0.992, 20.89, -13.0, 0.0, -300.0, 300.0, 0.0, 0.0, 0.0],
            [25, 1, 0, 1.05, 27.93, 220.0, 0.0, -47.0, 140.0, 0.0, 0.0, 0.0],
            [26, 1, 1, 1.015, 29.71, 314.0, 0.0, -1000.0, 1000.0, 0.0, 0.0, 0.0],
            [27, 1, 1, 0.968, 15.35, -9.0, 0.0, -300.0, 300.0, 62.0, 13.0, 0.0],
            [28, 0, 0, 0.962, 13.62, 0.0, 0.0, 0.0, 0.0, 17.0, 7.0, 0.0],
            [29, 0, 0, 0.963, 12.63, 0.0, 0.0, 0.0, 0.0, 24.0, 4.0, 0.0],
            [30, 0, 0, 0.968, 18.79, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [31, 1, 1, 0.967, 12.75, 7.0, 0.0, -300.0, 300.0, 43.0, 27.0, 0.0],
            [32, 1, 0, 0.964, 14.8, 0.0, 0.0, -14.0, 42.0, 59.0, 23.0, 0.0],
            [33, 0, 0, 0.972, 10.63, 0.0, 0.0, 0.0, 0.0, 23.0, 9.0, 0.0],
            [34, 1, 0, 0.986, 11.3, 0.0, 0.0, -8.0, 24.0, 59.0, 26.0, 14.0],
            [35, 0, 0, 0.981, 10.87, 0.0, 0.0, 0.0, 0.0, 33.0, 9.0, 0.0],
            [36, 1, 0, 0.98, 10.87, 0.0, 0.0, -8.0, 24.0, 31.0, 17.0, 0.0],
            [37, 0, 0, 0.992, 11.77, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -25.0],
            [38, 0, 0, 0.962, 16.91, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [39, 0, 0, 0.97, 8.41, 0.0, 0.0, 0.0, 0.0, 27.0, 11.0, 0.0],
            [40, 1, 1, 0.97, 7.35, -46.0, 0.0, -300.0, 300.0, 20.0, 23.0, 0.0],
            [41, 0, 0, 0.967, 6.92, 0.0, 0.0, 0.0, 0.0, 37.0, 10.0, 0.0],
            [42, 1, 1, 0.985, 8.53, -59.0, 0.0, -300.0, 300.0, 37.0, 23.0, 0.0],
            [43, 0, 0, 0.978, 11.28, 0.0, 0.0, 0.0, 0.0, 18.0, 7.0, 0.0],
            [44, 0, 0, 0.985, 13.82, 0.0, 0.0, 0.0, 0.0, 16.0, 8.0, 10.0],
            [45, 0, 0, 0.987, 15.67, 0.0, 0.0, 0.0, 0.0, 53.0, 22.0, 10.0],
            [46, 1, 0, 1.005, 18.49, 19.0, 0.0, -100.0, 100.0, 28.0, 10.0, 10.0],
            [47, 0, 0, 1.017, 20.73, 0.0, 0.0, 0.0, 0.0, 34.0, 0.0, 0.0],
            [48, 0, 0, 1.021, 19.93, 0.0, 0.0, 0.0, 0.0, 20.0, 11.0, 15.0],
            [49, 1, 0, 1.025, 20.94, 204.0, 0.0, -85.0, 210.0, 87.0, 30.0, 0.0],
            [50, 0, 0, 1.001, 18.9, 0.0, 0.0, 0.0, 0.0, 17.0, 4.0, 0.0],
            [51, 0, 0, 0.967, 16.28, 0.0, 0.0, 0.0, 0.0, 17.0, 8.0, 0.0],
            [52, 0, 0, 0.957, 15.32, 0.0, 0.0, 0.0, 0.0, 18.0, 5.0, 0.0],
            [53, 0, 0, 0.946, 14.35, 0.0, 0.0, 0.0, 0.0, 23.0, 11.0, 0.0],
            [54, 1, 1, 0.955, 15.26, 48.0, 0.0, -300.0, 300.0, 113.0, 32.0, 0.0],
            [55, 1, 0, 0.952, 14.97, 0.0, 0.0, -8.0, 23.0, 63.0, 22.0, 0.0],
            [56, 1, 0, 0.954, 15.16, 0.0, 0.0, -8.0, 15.0, 84.0, 18.0, 0.0],
            [57, 0, 0, 0.971, 16.36, 0.0, 0.0, 0.0, 0.0, 12.0, 3.0, 0.0],
            [58, 0, 0, 0.959, 15.51, 0.0, 0.0, 0.0, 0.0, 12.0, 3.0, 0.0],
            [59, 1, 0, 0.985, 19.37, 155.0, 0.0, -60.0, 180.0, 277.0, 113.0, 0.0],
            [60, 0, 0, 0.993, 23.15, 0.0, 0.0, 0.0, 0.0, 78.0, 3.0, 0.0],
            [61, 1, 1, 0.995, 24.04, 160.0, 0.0, -100.0, 300.0, 0.0, 0.0, 0.0],
            [62, 1, 0, 0.998, 23.43, 0.0, 0.0, -20.0, 20.0, 77.0, 14.0, 0.0],
            [63, 0, 0, 0.969, 22.75, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [64, 0, 0, 0.984, 24.52, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [65, 1, 0, 1.005, 27.65, 391.0, 0.0, -67.0, 200.0, 0.0, 0.0, 0.0],
            [66, 1, 0, 1.05, 27.48, 392.0, 0.0, -67.0, 200.0, 39.0, 18.0, 0.0],
            [67, 0, 0, 1.02, 24.84, 0.0, 0.0, 0.0, 0.0, 28.0, 7.0, 0.0],
            [68, 0, 0, 1.003, 27.55, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [69, 2, 1, 1.035, 30.0, 516.4, 0.0, -300.0, 300.0, 0.0, 0.0, 0.0],
            [70, 1, 0, 0.984, 22.58, 0.0, 0.0, -10.0, 32.0, 66.0, 20.0, 0.0],
            [71, 0, 0, 0.987, 22.15, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [72, 1, 0, 0.98, 20.98, -12.0, 0.0, -100.0, 100.0, 0.0, 0.0, 0.0],
            [73, 1, 0, 0.991, 21.94, -6.0, 0.0, -100.0, 100.0, 0.0, 0.0, 0.0],
            [74, 1, 0, 0.958, 21.64, 0.0, 0.0, -6.0, 9.0, 68.0, 27.0, 12.0],
            [75, 0, 0, 0.967, 22.91, 0.0, 0.0, 0.0, 0.0, 47.0, 11.0, 0.0],
            [76, 1, 0, 0.943, 21.77, 0.0, 0.0, -8.0, 23.0, 68.0, 36.0, 0.0],
            [77, 1, 0, 1.006, 26.72, 0.0, 0.0, -20.0, 70.0, 61.0, 28.0, 0.0],
            [78, 0, 0, 1.003, 26.42, 0.0, 0.0, 0.0, 0.0, 71.0, 26.0, 0.0],
            [79, 0, 0, 1.009, 26.72, 0.0, 0.0, 0.0, 0.0, 39.0, 32.0, 20.0],
            [80, 1, 1, 1.04, 28.96, 477.0, 0.0, -165.0, 280.0, 130.0, 26.0, 0.0],
            [81, 0, 0, 0.997, 28.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [82, 0, 0, 0.989, 27.24, 0.0, 0.0, 0.0, 0.0, 54.0, 27.0, 20.0],
            [83, 0, 0, 0.985, 28.42, 0.0, 0.0, 0.0, 0.0, 20.0, 10.0, 10.0],
            [84, 0, 0, 0.98, 30.95, 0.0, 0.0, 0.0, 0.0, 11.0, 7.0, 0.0],
            [85, 1, 0, 0.985, 32.51, 0.0, 0.0, -8.0, 23.0, 24.0, 15.0, 0.0],
            [86, 0, 0, 0.987, 31.14, 0.0, 0.0, 0.0, 0.0, 21.0, 10.0, 0.0],
            [87, 1, 0, 1.015, 31.4, 4.0, 0.0, -100.0, 1000.0, 0.0, 0.0, 0.0],
            [88, 0, 0, 0.987, 35.64, 0.0, 0.0, 0.0, 0.0, 48.0, 10.0, 0.0],
            [89, 1, 1, 1.005, 39.69, 607.0, 0.0, -210.0, 300.0, 0.0, 0.0, 0.0],
            [90, 1, 1, 0.985, 33.29, -85.0, 0.0, -300.0, 300.0, 78.0, 42.0, 0.0],
            [91, 1, 0, 0.98, 33.31, -10.0, 0.0, -100.0, 100.0, 0.0, 0.0, 0.0],
            [92, 1, 0, 0.993, 33.8, 0.0, 0.0, -3.0, 9.0, 65.0, 10.0, 0.0],
            [93, 0, 0, 0.987, 30.79, 0.0, 0.0, 0.0, 0.0, 12.0, 7.0, 0.0],
            [94, 0, 0, 0.991, 28.64, 0.0, 0.0, 0.0, 0.0, 30.0, 16.0, 0.0],
            [95, 0, 0, 0.981, 27.67, 0.0, 0.0, 0.0, 0.0, 42.0, 31.0, 0.0],
            [96, 0, 0, 0.993, 27.51, 0.0, 0.0, 0.0, 0.0, 38.0, 15.0, 0.0],
            [97, 0, 0, 1.011, 27.88, 0.0, 0.0, 0.0, 0.0, 15.0, 9.0, 0.0],
            [98, 0, 0, 1.024, 27.4, 0.0, 0.0, 0.0, 0.0, 34.0, 8.0, 0.0],
            [99, 1, 1, 1.01, 27.04, -42.0, 0.0, -100.0, 100.0, 0.0, 0.0, 0.0],
            [100, 1, 0, 1.017, 28.03, 252.0, 0.0, -50.0, 155.0, 37.0, 18.0, 0.0],
            [101, 0, 0, 0.993, 29.61, 0.0, 0.0, 0.0, 0.0, 22.0, 15.0, 0.0],
            [102, 0, 0, 0.991, 32.3, 0.0, 0.0, 0.0, 0.0, 5.0, 3.0, 0.0],
            [103, 1, 0, 1.001, 24.44, 40.0, 0.0, -15.0, 40.0, 23.0, 16.0, 0.0],
            [104, 1, 0, 0.971, 21.69, 0.0, 0.0, -8.0, 23.0, 38.0, 25.0, 0.0],
            [105, 1, 0, 0.965, 20.57, 0.0, 0.0, -8.0, 23.0, 31.0, 26.0, 20.0],
            [106, 0, 0, 0.962, 20.32, 0.0, 0.0, 0.0, 0.0, 43.0, 16.0, 0.0],
            [107, 1, 1, 0.952, 17.53, -22.0, 0.0, -200.0, 200.0, 28.0, 12.0, 6.0],
            [108, 0, 0, 0.967, 19.38, 0.0, 0.0, 0.0, 0.0, 2.0, 1.0, 0.0],
            [109, 0, 0, 0.967, 18.93, 0.0, 0.0, 0.0, 0.0, 8.0, 3.0, 0.0],
            [110, 1, 0, 0.973, 18.09, 0.0, 0.0, -8.0, 23.0, 39.0, 30.0, 6.0],
            [111, 1, 1, 0.98, 19.74, 36.0, 0.0, -100.0, 1000.0, 0.0, 0.0, 0.0],
            [112, 1, 1, 0.975, 14.99, -43.0, 0.0, -100.0, 1000.0, 25.0, 13.0, 0.0],
            [113, 1, 0, 0.993, 13.74, -6.0, 0.0, -100.0, 200.0, 0.0, 0.0, 0.0],
            [114, 0, 0, 0.96, 14.46, 0.0, 0.0, 0.0, 0.0, 8.0, 3.0, 0.0],
            [115, 0, 0, 0.96, 14.46, 0.0, 0.0, 0.0, 0.0, 22.0, 7.0, 0.0],
            [116, 1, 1, 1.005, 27.12, -184.0, 0.0, -1000.0, 1000.0, 0.0, 0.0, 0.0],
            [117, 0, 0, 0.974, 10.67, 0.0, 0.0, 0.0, 0.0, 20.0, 8.0, 0.0],
            [118, 0, 0, 0.949, 21.92, 0.0, 0.0, 0.0, 0.0, 33.0, 15.0, 0.0],
            [119, 0, 0, 0.97, 11.23, 0.0, 0.0, -10.0, 30.0, 40.0, 12.0, 0.0]
        ]
        
        self.buses = []
        for row in bus_data:
            self.buses.append(
                Bus(self, 
                    id=int(row[0]), 
                    bus_type=bus_type_map.get(int(row[1]), 'PQ'), 
                    v=float(row[3]), 
                    theta=math.radians(float(row[4])),
                    Sh=float(row[11])
                )
            )

    def _create_lines(self):
        """
        Cria as 187 linhas e transformadores a partir da matriz DLIN.
        """
        # Dados da matriz DLIN: [From, T0, r, x, Bsh, tap_ratio]
        line_data = [
            [1, 2, 3.03, 9.99, 2.54, 0.0], [1, 3, 1.29, 4.24, 1.082, 0.0],
            [4, 5, 0.176, 0.798, 0.21, 0.0], [3, 5, 2.41, 10.8, 2.84, 0.0],
            [5, 6, 1.19, 5.4, 1.426, 0.0], [6, 7, 0.459, 2.08, 0.55, 0.0],
            [8, 9, 0.244, 3.05, 116.2, 0.0], [8, 5, 0.0, 2.67, 0.0, 0.985],
            [9, 10, 0.258, 3.22, 123.0, 0.0], [4, 11, 2.09, 6.88, 1.748, 0.0],
            [5, 11, 2.03, 6.82, 1.738, 0.0], [11, 12, 0.595, 1.96, 0.502, 0.0],
            [2, 12, 1.87, 6.16, 1.572, 0.0], [3, 12, 4.84, 16.0, 4.06, 0.0],
            [7, 12, 0.862, 3.4, 0.874, 0.0], [11, 13, 2.225, 7.31, 1.876, 0.0],
            [12, 14, 2.15, 7.07, 1.816, 0.0], [13, 15, 7.44, 24.44, 6.268, 0.0],
            [14, 15, 5.95, 19.5, 5.02, 0.0], [12, 16, 2.12, 8.34, 2.14, 0.0],
            [15, 17, 1.32, 4.37, 4.44, 0.0], [16, 17, 4.54, 18.01, 4.66, 0.0],
            [17, 18, 1.23, 5.05, 1.298, 0.0], [18, 19, 1.119, 4.93, 1.142, 0.0],
            [19, 20, 2.52, 11.7, 2.98, 0.0], [15, 19, 1.2, 3.94, 1.01, 0.0],
            [20, 21, 1.83, 8.49, 2.16, 0.0], [21, 22, 2.09, 9.7, 2.46, 0.0],
            [22, 23, 3.42, 15.9, 4.04, 0.0], [23, 24, 1.35, 4.92, 4.98, 0.0],
            [23, 25, 1.56, 8.0, 8.64, 0.0], [26, 25, 0.0, 3.82, 0.0, 0.96],
            [25, 27, 3.18, 16.3, 17.64, 0.0], [27, 28, 1.913, 8.55, 2.16, 0.0],
            [28, 29, 2.37, 9.43, 2.38, 0.0], [30, 17, 0.0, 3.88, 0.0, 0.96],
            [8, 30, 0.431, 5.04, 51.4, 0.0], [26, 30, 0.799, 8.6, 90.8, 0.0],
            [17, 31, 4.74, 15.63, 3.99, 0.0], [29, 31, 1.08, 3.31, 0.83, 0.0],
            [23, 32, 3.17, 11.53, 11.73, 0.0], [31, 32, 2.98, 9.85, 2.51, 0.0],
            [27, 32, 2.29, 7.55, 1.926, 0.0], [15, 33, 3.8, 12.44, 3.194, 0.0],
            [19, 34, 7.52, 24.7, 6.32, 0.0], [35, 36, 0.224, 1.02, 0.268, 0.0],
            [35, 37, 1.1, 4.97, 1.318, 0.0], [33, 37, 4.15, 14.2, 3.66, 0.0],
            [34, 36, 0.871, 2.68, 0.568, 0.0], [34, 37, 0.256, 0.94, 0.984, 0.0],
            [38, 37, 0.0, 3.75, 0.0, 0.935], [37, 39, 3.21, 10.6, 2.7, 0.0],
            [37, 40, 5.93, 16.8, 4.2, 0.0], [30, 38, 0.464, 5.4, 42.2, 0.0],
            [39, 40, 1.84, 6.05, 1.552, 0.0], [40, 41, 1.45, 4.87, 1.222, 0.0],
            [40, 42, 5.55, 18.3, 4.66, 0.0], [41, 42, 4.1, 13.5, 3.44, 0.0],
            [43, 44, 6.08, 24.54, 6.068, 0.0], [34, 43, 4.13, 16.81, 4.226, 0.0],
            [44, 45, 2.24, 9.01, 2.24, 0.0], [45, 46, 4.0, 13.56, 3.32, 0.0],
            [46, 47, 3.8, 12.7, 3.16, 0.0], [46, 48, 6.01, 18.9, 4.72, 0.0],
            [47, 49, 1.91, 6.25, 1.604, 0.0], [42, 49, 7.15, 32.3, 8.6, 0.0],
            [42, 49, 7.15, 32.3, 8.6, 0.0], [45, 49, 6.84, 18.6, 4.44, 0.0],
            [48, 49, 1.79, 5.05, 1.258, 0.0], [49, 50, 2.67, 7.52, 1.874, 0.0],
            [49, 51, 4.86, 13.7, 3.42, 0.0], [51, 52, 2.03, 5.88, 1.396, 0.0],
            [52, 53, 4.05, 16.35, 4.058, 0.0], [53, 54, 2.63, 12.2, 3.1, 0.0],
            [49, 54, 7.3, 28.9, 7.38, 0.0], [49, 54, 8.69, 29.1, 7.3, 0.0],
            [54, 55, 1.69, 7.07, 2.02, 0.0], [54, 56, 0.275, 0.955, 0.732, 0.0],
            [55, 56, 0.488, 1.51, 0.374, 0.0], [56, 57, 3.43, 9.66, 2.42, 0.0],
            [50, 57, 4.74, 13.4, 3.32, 0.0], [56, 58, 3.43, 9.66, 2.42, 0.0],
            [51, 58, 2.55, 7.19, 1.788, 0.0], [54, 59, 5.03, 22.93, 5.98, 0.0],
            [56, 59, 8.25, 25.1, 5.69, 0.0], [56, 59, 8.03, 23.9, 5.36, 0.0],
            [55, 59, 4.739, 21.58, 5.646, 0.0], [59, 60, 3.17, 14.5, 3.76, 0.0],
            [59, 61, 3.28, 15.0, 3.88, 0.0], [60, 61, 0.264, 1.35, 1.456, 0.0],
            [60, 62, 1.23, 5.61, 1.468, 0.0], [61, 62, 0.824, 3.76, 0.98, 0.0],
            [63, 59, 0.0, 3.86, 0.0, 0.96], [63, 64, 0.172, 2.0, 21.6, 0.0],
            [64, 61, 0.0, 2.68, 0.0, 0.985], [38, 65, 0.901, 9.86, 104.6, 0.0],
            [64, 65, 0.269, 3.02, 38.0, 0.0], [49, 66, 1.8, 9.19, 2.48, 0.0],
            [49, 66, 1.8, 9.19, 2.48, 0.0], [62, 66, 4.82, 21.8, 5.78, 0.0],
            [62, 67, 2.58, 11.7, 3.1, 0.0], [65, 66, 0.0, 3.7, 0.0, 0.935],
            [66, 67, 2.24, 10.15, 2.682, 0.0], [65, 68, 0.138, 1.6, 63.8, 0.0],
            [47, 69, 8.44, 27.78, 7.092, 0.0], [49, 69, 9.85, 32.4, 8.28, 0.0],
            [68, 69, 0.0, 3.7, 0.0, 0.935], [69, 70, 3.0, 12.7, 12.2, 0.0],
            [24, 70, 0.221, 41.15, 10.198, 0.0], [70, 71, 0.882, 3.55, 0.878, 0.0],
            [24, 72, 4.88, 19.6, 4.88, 0.0], [71, 72, 4.46, 18.0, 4.444, 0.0],
            [71, 73, 0.866, 4.54, 1.178, 0.0], [70, 74, 4.01, 13.23, 3.368, 0.0],
            [70, 75, 4.28, 14.1, 3.6, 0.0], [69, 75, 4.05, 12.2, 12.4, 0.0],
            [74, 75, 1.23, 4.06, 1.034, 0.0], [76, 77, 4.44, 14.8, 3.68, 0.0],
            [69, 77, 3.09, 10.1, 10.38, 0.0], [75, 77, 6.01, 19.99, 4.978, 0.0],
            [77, 78, 0.376, 1.24, 1.264, 0.0], [78, 79, 0.546, 2.44, 0.648, 0.0],
            [77, 80, 1.7, 4.85, 4.72, 0.0], [77, 80, 2.94, 10.5, 2.28, 0.0],
            [79, 80, 1.56, 7.04, 1.87, 0.0], [68, 81, 0.175, 2.02, 80.8, 0.0],
            [81, 80, 0.0, 3.7, 0.0, 0.935], [77, 82, 2.98, 8.53, 8.174, 0.0],
            [82, 83, 1.12, 3.665, 3.796, 0.0], [83, 84, 6.25, 13.2, 2.58, 0.0],
            [83, 85, 4.3, 14.8, 3.48, 0.0], [84, 85, 3.02, 6.41, 1.234, 0.0],
            [85, 86, 3.5, 12.3, 2.76, 0.0], [86, 87, 2.828, 20.74, 4.45, 0.0],
            [85, 88, 2.0, 10.2, 2.76, 0.0], [85, 89, 2.39, 17.3, 4.7, 0.0],
            [88, 89, 1.39, 7.12, 1.934, 0.0], [89, 90, 5.18, 18.8, 5.28, 0.0],
            [89, 90, 2.38, 9.97, 10.6, 0.0], [90, 91, 2.54, 8.36, 2.14, 0.0],
            [89, 92, 0.99, 5.05, 5.48, 0.0], [89, 92, 3.93, 15.81, 4.14, 0.0],
            [91, 92, 3.87, 12.72, 3.268, 0.0], [92, 93, 2.58, 8.48, 2.18, 0.0],
            [92, 94, 4.81, 15.8, 4.06, 0.0], [93, 94, 2.23, 7.32, 1.876, 0.0],
            [94, 95, 1.32, 4.34, 1.11, 0.0], [80, 96, 3.56, 18.2, 4.94, 0.0],
            [82, 96, 1.62, 5.3, 5.44, 0.0], [94, 96, 2.69, 8.69, 2.3, 0.0],
            [80, 97, 1.83, 9.34, 2.54, 0.0], [80, 98, 2.38, 10.8, 2.86, 0.0],
            [80, 99, 4.54, 20.6, 5.46, 0.0], [92, 100, 6.48, 29.5, 4.72, 0.0],
            [94, 100, 1.78, 5.8, 6.04, 0.0], [95, 96, 1.71, 5.47, 1.474, 0.0],
            [96, 97, 1.73, 8.85, 2.4, 0.0], [98, 100, 3.97, 17.9, 4.76, 0.0],
            [99, 100, 1.8, 8.13, 2.16, 0.0], [100, 101, 2.77, 12.62, 3.28, 0.0],
            [92, 102, 1.23, 5.59, 1.464, 0.0], [101, 102, 2.46, 11.2, 2.94, 0.0],
            [100, 103, 1.6, 5.25, 5.36, 0.0], [100, 104, 4.51, 20.4, 5.41, 0.0],
            [103, 104, 4.66, 15.84, 4.07, 0.0], [103, 105, 5.35, 16.25, 4.08, 0.0],
            [100, 106, 6.05, 22.9, 6.2, 0.0], [104, 105, 0.994, 3.78, 0.986, 0.0],
            [105, 106, 1.4, 5.47, 1.434, 0.0], [105, 107, 5.3, 18.3, 4.72, 0.0],
            [105, 108, 2.61, 7.03, 1.844, 0.0], [106, 107, 5.3, 18.3, 4.72, 0.0],
            [108, 109, 1.05, 2.88, 0.76, 0.0], [103, 110, 3.906, 18.13, 4.61, 0.0],
            [109, 110, 2.78, 7.62, 2.02, 0.0], [110, 111, 2.2, 7.55, 2.0, 0.0],
            [110, 112, 2.47, 6.4, 6.2, 0.0], [17, 113, 0.913, 3.01, 0.768, 0.0],
            [32, 113, 6.15, 20.3, 5.18, 0.0], [32, 114, 1.35, 6.12, 1.628, 0.0],
            [27, 115, 1.64, 7.41, 1.972, 0.0], [114, 115, 0.23, 1.04, 0.276, 0.0],
            [68, 116, 0.034, 0.405, 16.4, 0.0], [12, 117, 3.29, 14.0, 3.58, 0.0],
            [75, 118, 1.45, 4.81, 1.198, 0.0], [76, 118, 1.64, 5.44, 1.356, 0.0],
            [119, 70, 0.221, 41.15, 10.198, 0.0]
        ]

        self.lines = []
        for i, row in enumerate(line_data):
            from_bus_id = int(row[0])
            to_bus_id = int(row[1])
            tap_ratio = float(row[5]) if float(row[5]) != 0 else 1.0
            
            self.lines.append(
                Line(id=i + 1,
                     from_bus=self.buses[from_bus_id - 1],
                     to_bus=self.buses[to_bus_id - 1],
                     r=float(row[2]),
                     x=float(row[3]),
                     b_half=float(row[4]) / 2.0,
                     tap_ratio=tap_ratio
                )
            )

    def _create_generators(self):
        """
        Cria geradores a partir de DBAR (convencionais) e DGW (eólicos).
        """
        self.generators = []
        gen_id = 1
        
        bus_data = [
            [1, 1, 0, 0.955, 10.67, 0.0], [2, 0, 0, 0.971, 11.22, 0.0],
            [3, 0, 0, 0.968, 11.56, 0.0], [4, 1, 1, 0.998, 15.28, -9.0],
            [5, 0, 0, 1.002, 15.73, 0.0], [6, 1, 0, 0.99, 13.0, 0.0],
            [7, 0, 0, 0.989, 12.56, 0.0], [8, 1, 1, 1.015, 20.77, -28.0],
            [9, 0, 0, 1.043, 28.02, 0.0], [10, 1, 1, 1.05, 35.61, 450.0],
            [11, 0, 0, 0.985, 12.72, 0.0], [12, 1, 0, 0.99, 12.2, 85.0],
            [13, 0, 0, 0.968, 11.35, 0.0], [14, 0, 0, 0.984, 11.5, 0.0],
            [15, 1, 0, 0.97, 11.23, 0.0], [16, 0, 0, 0.984, 11.91, 0.0],
            [17, 0, 0, 0.995, 13.74, 0.0], [18, 1, 0, 0.973, 11.53, 0.0],
            [19, 1, 0, 0.963, 11.05, 0.0], [20, 0, 0, 0.958, 11.93, 0.0],
            [21, 0, 0, 0.959, 13.52, 0.0], [22, 0, 0, 0.97, 16.08, 0.0],
            [23, 0, 0, 1.0, 21.0, 0.0], [24, 1, 1, 0.992, 20.89, -13.0],
            [25, 1, 0, 1.05, 27.93, 220.0], [26, 1, 1, 1.015, 29.71, 314.0],
            [27, 1, 1, 0.968, 15.35, -9.0], [28, 0, 0, 0.962, 13.62, 0.0],
            [29, 0, 0, 0.963, 12.63, 0.0], [30, 0, 0, 0.968, 18.79, 0.0],
            [31, 1, 1, 0.967, 12.75, 7.0], [32, 1, 0, 0.964, 14.8, 0.0],
            [33, 0, 0, 0.972, 10.63, 0.0], [34, 1, 0, 0.986, 11.3, 0.0],
            [35, 0, 0, 0.981, 10.87, 0.0], [36, 1, 0, 0.98, 10.87, 0.0],
            [37, 0, 0, 0.992, 11.77, 0.0], [38, 0, 0, 0.962, 16.91, 0.0],
            [39, 0, 0, 0.97, 8.41, 0.0], [40, 1, 1, 0.97, 7.35, -46.0],
            [41, 0, 0, 0.967, 6.92, 0.0], [42, 1, 1, 0.985, 8.53, -59.0],
            [43, 0, 0, 0.978, 11.28, 0.0], [44, 0, 0, 0.985, 13.82, 0.0],
            [45, 0, 0, 0.987, 15.67, 0.0], [46, 1, 0, 1.005, 18.49, 19.0],
            [47, 0, 0, 1.017, 20.73, 0.0], [48, 0, 0, 1.021, 19.93, 0.0],
            [49, 1, 0, 1.025, 20.94, 204.0], [50, 0, 0, 1.001, 18.9, 0.0],
            [51, 0, 0, 0.967, 16.28, 0.0], [52, 0, 0, 0.957, 15.32, 0.0],
            [53, 0, 0, 0.946, 14.35, 0.0], [54, 1, 1, 0.955, 15.26, 48.0],
            [55, 1, 0, 0.952, 14.97, 0.0], [56, 1, 0, 0.954, 15.16, 0.0],
            [57, 0, 0, 0.971, 16.36, 0.0], [58, 0, 0, 0.959, 15.51, 0.0],
            [59, 1, 0, 0.985, 19.37, 155.0], [60, 0, 0, 0.993, 23.15, 0.0],
            [61, 1, 1, 0.995, 24.04, 160.0], [62, 1, 0, 0.998, 23.43, 0.0],
            [63, 0, 0, 0.969, 22.75, 0.0], [64, 0, 0, 0.984, 24.52, 0.0],
            [65, 1, 0, 1.005, 27.65, 391.0], [66, 1, 0, 1.05, 27.48, 392.0],
            [67, 0, 0, 1.02, 24.84, 0.0], [68, 0, 0, 1.003, 27.55, 0.0],
            [69, 2, 1, 1.035, 30.0, 516.4], [70, 1, 0, 0.984, 22.58, 0.0],
            [71, 0, 0, 0.987, 22.15, 0.0], [72, 1, 0, 0.98, 20.98, -12.0],
            [73, 1, 0, 0.991, 21.94, -6.0], [74, 1, 0, 0.958, 21.64, 0.0],
            [75, 0, 0, 0.967, 22.91, 0.0], [76, 1, 0, 0.943, 21.77, 0.0],
            [77, 1, 0, 1.006, 26.72, 0.0], [78, 0, 0, 1.003, 26.42, 0.0],
            [79, 0, 0, 1.009, 26.72, 0.0], [80, 1, 1, 1.04, 28.96, 477.0],
            [81, 0, 0, 0.997, 28.1, 0.0], [82, 0, 0, 0.989, 27.24, 0.0],
            [83, 0, 0, 0.985, 28.42, 0.0], [84, 0, 0, 0.98, 30.95, 0.0],
            [85, 1, 0, 0.985, 32.51, 0.0], [86, 0, 0, 0.987, 31.14, 0.0],
            [87, 1, 0, 1.015, 31.4, 4.0], [88, 0, 0, 0.987, 35.64, 0.0],
            [89, 1, 1, 1.005, 39.69, 607.0], [90, 1, 1, 0.985, 33.29, -85.0],
            [91, 1, 0, 0.98, 33.31, -10.0], [92, 1, 0, 0.993, 33.8, 0.0],
            [93, 0, 0, 0.987, 30.79, 0.0], [94, 0, 0, 0.991, 28.64, 0.0],
            [95, 0, 0, 0.981, 27.67, 0.0], [96, 0, 0, 0.993, 27.51, 0.0],
            [97, 0, 0, 1.011, 27.88, 0.0], [98, 0, 0, 1.024, 27.4, 0.0],
            [99, 1, 1, 1.01, 27.04, -42.0], [100, 1, 0, 1.017, 28.03, 252.0],
            [101, 0, 0, 0.993, 29.61, 0.0], [102, 0, 0, 0.991, 32.3, 0.0],
            [103, 1, 0, 1.001, 24.44, 40.0], [104, 1, 0, 0.971, 21.69, 0.0],
            [105, 1, 0, 0.965, 20.57, 0.0], [106, 0, 0, 0.962, 20.32, 0.0],
            [107, 1, 1, 0.952, 17.53, -22.0], [108, 0, 0, 0.967, 19.38, 0.0],
            [109, 0, 0, 0.967, 18.93, 0.0], [110, 1, 0, 0.973, 18.09, 0.0],
            [111, 1, 1, 0.98, 19.74, 36.0], [112, 1, 1, 0.975, 14.99, -43.0],
            [113, 1, 0, 0.993, 13.74, -6.0], [114, 0, 0, 0.96, 14.46, 0.0],
            [115, 0, 0, 0.96, 14.46, 0.0], [116, 1, 1, 1.005, 27.12, -184.0],
            [117, 0, 0, 0.974, 10.67, 0.0], [118, 0, 0, 0.949, 21.92, 0.0],
            [119, 0, 0, 0.97, 11.23, 0.0]
        ]
        
        for row in bus_data:
            is_gen_bus = (int(row[2]) == 1 or int(row[1]) in [1, 2])
            if is_gen_bus:
                bus_id = int(row[0])
                p_gen = float(row[5])
                self.generators.append(
                    Generator(id=gen_id, bus=self.buses[bus_id - 1], pb=100, p_input=p_gen)
                )
                gen_id += 1
        
        wind_gen_data = [
            [1, 0.0, 10], [8, 0.0, 10], [15, 0.0, 15], [24, 0.0, 15],
            [54, 0.0, 30], [59, 0.0, 20], [69, 0.0, 20], [74, 0.0, 10],
            [80, 0.0, 15], [85, 0.0, 10], [110, 0.0, 20]
        ]
        
        for row in wind_gen_data:
            bus_id = int(row[0])
            self.generators.append(
                Generator(id=gen_id, bus=self.buses[bus_id - 1], pb=100, p_input=0.0)
            )
            gen_id += 1

    def _create_loads(self):
        """
        Cria as cargas a partir das colunas PLOAD e QLOAD da matriz DBAR.
        """
        bus_data = [
            [1, 51.0, 27.0], [2, 20.0, 9.0], [3, 39.0, 10.0], [4, 30.0, 12.0],
            [5, 0.0, 0.0], [6, 52.0, 22.0], [7, 19.0, 2.0], [8, 0.0, 0.0],
            [9, 0.0, 0.0], [10, 0.0, 0.0], [11, 70.0, 23.0], [12, 47.0, 10.0],
            [13, 34.0, 16.0], [14, 14.0, 1.0], [15, 90.0, 30.0], [16, 25.0, 10.0],
            [17, 11.0, 3.0], [18, 60.0, 34.0], [19, 45.0, 25.0], [20, 18.0, 3.0],
            [21, 14.0, 8.0], [22, 10.0, 5.0], [23, 7.0, 3.0], [24, 0.0, 0.0],
            [25, 0.0, 0.0], [26, 0.0, 0.0], [27, 62.0, 13.0], [28, 17.0, 7.0],
            [29, 24.0, 4.0], [30, 0.0, 0.0], [31, 43.0, 27.0], [32, 59.0, 23.0],
            [33, 23.0, 9.0], [34, 59.0, 26.0], [35, 33.0, 9.0], [36, 31.0, 17.0],
            [37, 0.0, 0.0], [38, 0.0, 0.0], [39, 27.0, 11.0], [40, 20.0, 23.0],
            [41, 37.0, 10.0], [42, 37.0, 23.0], [43, 18.0, 7.0], [44, 16.0, 8.0],
            [45, 53.0, 22.0], [46, 28.0, 10.0], [47, 34.0, 0.0], [48, 20.0, 11.0],
            [49, 87.0, 30.0], [50, 17.0, 4.0], [51, 17.0, 8.0], [52, 18.0, 5.0],
            [53, 23.0, 11.0], [54, 113.0, 32.0], [55, 63.0, 22.0], [56, 84.0, 18.0],
            [57, 12.0, 3.0], [58, 12.0, 3.0], [59, 277.0, 113.0], [60, 78.0, 3.0],
            [61, 0.0, 0.0], [62, 77.0, 14.0], [63, 0.0, 0.0], [64, 0.0, 0.0],
            [65, 0.0, 0.0], [66, 39.0, 18.0], [67, 28.0, 7.0], [68, 0.0, 0.0],
            [69, 0.0, 0.0], [70, 66.0, 20.0], [71, 0.0, 0.0], [72, 0.0, 0.0],
            [73, 0.0, 0.0], [74, 68.0, 27.0], [75, 47.0, 11.0], [76, 68.0, 36.0],
            [77, 61.0, 28.0], [78, 71.0, 26.0], [79, 39.0, 32.0], [80, 130.0, 26.0],
            [81, 0.0, 0.0], [82, 54.0, 27.0], [83, 20.0, 10.0], [84, 11.0, 7.0],
            [85, 24.0, 15.0], [86, 21.0, 10.0], [87, 0.0, 0.0], [88, 48.0, 10.0],
            [89, 0.0, 0.0], [90, 78.0, 42.0], [91, 0.0, 0.0], [92, 65.0, 10.0],
            [93, 12.0, 7.0], [94, 30.0, 16.0], [95, 42.0, 31.0], [96, 38.0, 15.0],
            [97, 15.0, 9.0], [98, 34.0, 8.0], [99, 0.0, 0.0], [100, 37.0, 18.0],
            [101, 22.0, 15.0], [102, 5.0, 3.0], [103, 23.0, 16.0], [104, 38.0, 25.0],
            [105, 31.0, 26.0], [106, 43.0, 16.0], [107, 28.0, 12.0], [108, 2.0, 1.0],
            [109, 8.0, 3.0], [110, 39.0, 30.0], [111, 0.0, 0.0], [112, 25.0, 13.0],
            [113, 0.0, 0.0], [114, 8.0, 3.0], [115, 22.0, 7.0], [116, 0.0, 0.0],
            [117, 20.0, 8.0], [118, 33.0, 15.0], [119, 40.0, 12.0]
        ]
        
        self.loads = []
        load_id = 1
        for row in bus_data:
            p_load = float(row[1])
            q_load = float(row[2])
            
            if p_load > 0 or q_load > 0:
                bus_id = int(row[0])
                self.loads.append(
                    Load(id=load_id,
                         bus=self.buses[bus_id - 1],
                         pb=100,
                         p_input=p_load,
                         q_input=q_load
                    )
                )
                load_id += 1